﻿﻿﻿﻿# Подготовка к созданию сертификатовСоздание инсталляционных файлов для NIT-System-Update Требует множества ручных операций. Будте терпиливы!- Скопируйте содержимое каталога /Make в каталог, куда вы будете помещать готовые сертификаты и утилиты. Хорошей идеей будет разместить их в кталоге %USERPROFILE%\\.cert_data- Установите программу *Multi-Edit 2008*, *@Text Replacer*, *sed* и т.д. для массовой замены строк в файлах и подкаталогах.- Установите собственные значения переменных окружения, с помощью которых генерируются сертификаты. Для этого осуществите поиск и замену по параметрам: 1. Поставьте нужные Вам значения переменных certcn, certo и cthnou. Это значение должно быть уникальным для каждого из сертификатов, поэтому они должны меняться непосредственно в командных файлах. 2. Смените имена сертификатов certname и подписывающего сертификата certsigname в соответствии с Вашей иерархией сертификатов. 3. Во всех командных файлах сделайте значение переменной certpath одинаковым и принимающим значение %USERPROFILE%\\.cert_data 4. Изменение остальных переменных должно происходить пароизвольно исходя из здравого смысла,По умолчанию срок годности сертификатов — сто лет. максимальная длина цепочки сертификатов — 5, фейковые сертификаты выписаны на компанию VeriSign.Также по умолчанию имя корневого сертификата — verifake1, промежуточного сертификата центра сертификации — verisign-gen0, сертификата доверенного издателя для подписи проектов — verifilesign1. # Генерация сертификатовДля генерации фейкового корневого сертификата центра сертификации необходимо запустить файл makemainfakesertificate1.bat. Если Вы хотите импортировать уже сгенерированный корневой сертификат (пропускается операция генерации и установки) импортируйте ключи реестра из файла certificates-all.reg.Для генерации промежуточного сертификата центра сертификации необходимо запустить файл makenitvirussertificate1.batДля генерации сертификата для подписи файлов необходимо запустить файл sign_virus1.batЗатем нужно конвертировать полученные сертификаты в pfx формат. Для этого выполните команды:```pvk2pfxcmd.bat verifake1pvk2pfxcmd.bat verisign-gen0pvk2pfxcmd.bat verifilesign1```В процессе генерации Вам нужно будет придумать и запомнить секретные ключи к закрытым файлам сертификатов. Запомните эти ключи, поскольку впоследствии они понадобятся при подписи других сертификатов по цепочке.Сгенерированные pfx сертификаты готовы к установке. Пароля для импорта сертификатов в хранилище Windows или подписи файлов пользователя не требуются.# Импорт готовых сертификатов в хранилище Microsoft WindowsДанный материал широко освещён в Интернете. Ручная установка осуществляется с помощью оснастки «Сертификаты». Отметим, что:- Сертификаты должны быть установлены в конфигурацию «локальный компьютер» (потребуется повышение прав).- Сертификат verifake1.pfx должен быть установлен в раздел «Доверенные корневые центры сертификации».- Сертификат verisign-gen0.pfx должен быть установлен в раздел «Промежуточные центры сертификации».- Сертификат verifilesign1.pfx должен быть установлен в два раздела: «Личное» и «Доверенные издатели».В принципе те же действия можно осуществить из командной строки. Для этого нужно сгенерировать инсталлятор.# Генерация инсталлятораДля генерации инсталлятора необходимо:- Скопируйте сертификаты verifake1.pfx, verisign-gen0.pfx, verifilesign1.pfx в каталог /Util (устанавливаемые файлы)- Установить из репозитория Chocolatey пакет Inno Setup- Двойным щелчком запустить файл Certificates-Install.iss- Нажать кнопку «Generate» на панели инструментов- Полученный exe файл окажется в каталоге с созданными инсталляторами. Можете импортировать его в каталог проекта NIT-System-Update. Подписывать данный инсталлятор не имеет смысла.